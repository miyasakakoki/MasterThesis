
序論で述べたとおり、本研究で解決する問題は以下の３つである。
\begin{itemize}
	\item 設置したものが正常に稼働し始めたかどうか確認するのが面倒\\
	設置者が、機器の操作を知っている必要が有る。\\
	また、ディスプレイ等をつけないことが多いので、別途確認する手段（ディスプレイとキーボードを持参等）を用意する必要がある。
	\item 設置後、正常に稼働しているのか確認するのが面倒\\
	NAPTの内側に設置されている事が多いので、Pingやsnmpでは確認できない。\\
	また、ネットワークの断絶等があった場合、稼働状況を確認できない。
	\item いつ稼働していていつ稼働していなかったのか管理するのが大変\\
	いつ稼働していていつ稼働していなかったのかがわからないと、データを正確に分析する事が出来ない。
\end{itemize}


\section{IoTサービスの構造の分析}
ここで、対象となるIoTサービスの構造について説明する。
IoTサービスは、IoT機器（機器）、ネットワーク、サーバーの3層から成り立っている。
IoT機器は、センシングしたデータを送り出す、または、送られてきたデータを元に何か動作を行うものである。
ネットワークは、末端のネットワークと、インターネットとに別れる。
末端のネットワークとインターネットとの出口には、NAPTが置かれていることが多い。
サーバーは、IoT機器から送られてきたデータを蓄積・分析し、表示または、IoT機器へ通知する。
 

% IoTサービスの構造について、各層に湧かれていること等を取り上げる
%
%IoTサービスの実装の難しさ
% 上記より、これこれこうだから、IoTサービスの実装が難しい事が分かった。
%


以下に状態監視のシステムを導入？しない場合の解決策を上げる

\section{機器設置箇所に行って、直接確認する}
直接設置箇所に行き、確認を行うという方法である。
この場合、ディスプレイとキーボードを持参するなどする必要がある。
そして、機器を良く知る者を行かせる必要もある。
設置台数が多いことや、設置個所が離れていることから、あまり現実的ではない。

\section{ICMP Pingを活用する}
ICMPとは、InternetControlMessageProtocolの略であり、IPパケットの送り元から送り先への間で起きた問題を通知する役割を持つ。
ICMPには、ICMP echo requestと、ICMP echo repryが定義されており、ICMP echo requestを受け取った機器は、ICMP echo repryを返送しなければならない。
PingはICMP echoを送信する為のプログラムで、IP網のトラブルの発見の他、特定のIPアドレスを持つ機器が稼働しているかどうか確認するためにも使われている。
Pingを使用して、IoT機器の稼働確認を行うというのがこの解決策である。
しかし、ICMPパケットは、セキュリティの都合上、ネットワーク機器で転送しないよう設定されている場合が多い。
また、一般的なネットワークでは、インターネットとの接続点にてネットワークを分離している事がある。
その場合、IoT機器のIPアドレスは、IoT機器の所属するネットワークでのみ通用するアドレスとなるため、外部からICMPパケットを送ることは出来ない。

%なんかいまいち説明になっていないのでコメントアウト
\begin{comment}
NAPTとは、NetworkAddressPortTranslationの略で、外部のネットワークと内部のネットワークを分離する機能を持つ。
そのため、機器管理者から送信された
具体的には、内側から外側へデータを送信する際、送信元IPアドレスとポート番号を機器のIPアドレスとポート番号に変換・記憶し、
外部から内部へデータの送信があった場合、記憶していたIPアドレスとポート番号から、送信先IPアドレスとポートを書き換え、内部へ転送する
そのため、内側から始る通信は問題ないが、外側から始まる通信はブロックしてしまう。
\end{comment}

\section{SNMPを利用する}
SNMPとは、SimpleNetworkManagementProtocolの略で、ネットワークに接続された機器を監視・制御するために作られている。
CPUの状態や起動してからの時間、メモリ使用量等を取得できるが、設定がめんどくさい。
また、制御もできるため、ネットワーク機器にてブロックされてしまう恐れがある。


しかし、これらの手法では、解決に至っていない。
そこで、通常（？）は、次のような方法で解決を図っている。
\section{Zabbixを使用する}

\section{Fluentd Elasticksearch Kibanaを利用する}
Fluientdとは、ログの転送を目的としたアプリケーション。
ログを転送する他、場合によってはバッファリング等も行う。
Elasticksearchとは、データベースの一つ。
Kibanaとは、可視化ツールの一つで、グラフの描画などが行える。
しかし、それぞれが「そのための」プログラムなので、それらを使って可視化までこぎつけるには、それぞれに対して設定が必要と鳴る。
また、Fluentdが動く機器である必要がある。
更に、Kibanaは可視化の為のシステムなので、一つの機器の状態を可視化するだけでも、ダッシュボードの作成からパネルの作成までする必要が有り、
多数の機器の状態を見るためには、それを複数回繰り返す必要がある。

\section{Telegraf Influxdb Grafanaを利用する}
Influxdbとは時系列データベースの一つで、データを時系列に沿って整理し格納する。
TelegrafとはInfluxdbへメモリ使用量等を格納するためのエージェントプログラムである。
Grafanaとは可視化ツールの一つで、グラフの描画等を行う事ができる。
これも、FluentdElastickSearchKibanaの時のように、それぞれに対して設定が必要で、機器の上でTelegrafが動く必要がある。
また、Grafanaについても、Kibanaと同様で、多数の機器を監視しようとするととても手間がかかる。

\section{SORACOM Airを利用する}
IoT向けネットワークとしてSORACOMAirというサービスがある。
SORACOMAirは携帯電話回線を使用し、IoT向けのネットワークを提供している。
携帯電話回線を使用するため、SIMカードを用いており、SIMカードのIDにより、個体の識別と通信状況の確認が行える。
しかし、IoT機器にSIMカードリーダ（？）等を接続する必要が有る。
また、SORACOMAirでは、インターネットとの接続にNAPTを使用しているため、外から状態を確認することは困難である。

\section{VPNを利用する}
VPNとは、VirtualPrivateNetworkの略で、インターネット越しに仮想的で閉鎖的なネットワークを構築するものである。
しかし、VPNを利用するには、VPNクライアントが使用できる必要がある。
また、仮想的なネットワークのIPアドレス帯とIoT機器がつながっているネットワークのIPアドレス帯が被らないように調節する必要があるため、IoT機器がつながるネットワークの構成を全て把握している必要がある。
（IPアドレス帯がかぶると、どちらのIoT機器がどちらのインターフェースにパケットを送り出すべきなのかわからなくなるため、調節が必要）
IoT機器の数を考えると、ネットワークの構成を把握することは困難である。



\begin{comment}
それぞれにおける既存の解決策と利点と欠点を以下に述べる
\section{設置したものが正常に稼働し始めたかどうか確認するのが面倒}
\subsection{機器にディスプレイとキーボードをつける}
\subsubsection{個々の機器ごとにつける場合}
機器１台あたりのコストがかさむ
勝手に操作されることがある（セキュリティーの問題）
\subsubsection{設置者が持参しつける場合}
機器にディスプレイを接続できる必要がある。
より安価な機器だと、ディスプレイを接続できない場合が多い。
勝手にディスプレイ等をつけ、操作されることがある（セキュリティーの問題）
\subsection{PCを持参し、接続する場合}
PCと接続できるインターフェースを用意する必要がある。
勝手にPCを繋がれるかもしれない。

上記２つは勝手に操作される可能性がある。

\subsection{遠隔からログインし、状態を確認する場合}
間にNAPTが挟まっている場合があるのでできない事がある。

また、上記３つとも共通だが、機器に対して知識のある人物が確認しなければならない。
設置場所が離れている場合は、それ相応のコストがかかる。
\subsection{機器にLED等の簡素なディスプレイをつける}
最も安価だが、機器にLEDをつけるのが、（そこまででも無いけど）めんどい。
また、詳しいことはわからない。



\section{設置後、正常に稼働しているのか確認するのが面倒}
\subsection{機器を直接現地に行って確認する}
設置場所が離れている場合が多いので、コストがかかる。
\subsection{遠隔から確認する}
\subsubsection{ICMP Pingを用いる}
ICMPとは：
	

この解決策の利点：
欠点としては、NAPTが障害となり、遠隔から確認することは無理。
NAPTとは：
\subsubsection{SNMPを用いる}
SNMPとは：

NAPTが障害となり、遠隔から確認することは無理。
\subsubsection{Fluentd Elastickserch Kibanaを使う。}
Fluentdとは：
ElastickSerchとは：
Kibanaとは：

Fluentdが入るような機器でないといけない。
また、サービス毎にグラフ描画の設定をしなければならない。
\subsubsection{Zabbix}
（調査中？）
\subsubsection{Telegraf + Influxdb + Grafana}
Telegrafとは
Influxdbとは
Grafanaとは
Telegrafが入るような機器でないといけない。
また、サービス毎にグラフ描画の設定をしなければならない。
\section{いつ稼働していて稼働していなかったのか管理するのが大変}
\subsection{ログファイルを回収して確認}
現地に行くのめんどい
\subsection{Fluentd Elasticksearch Kibanaを使う}
Fluentdが入るような機器でないといけない。
また、サービス毎にグラフ描画の設定をしなければならない。

\subsection{Telegraf + Influxdb + Grafanaを使う}
Telegrafが入るような機器でないといけない。
また、サービス毎にグラフ描画の設定をしなければならない。

\end{comment}

