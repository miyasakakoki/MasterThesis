岡本商店街での実験や、株式会社ルナネクサスへの聞き取りから、IoTサービスの構成上、IoT機器の監視には次のような要件を満たしている必要があることが分かった。
\begin{itemize}
\item IoT機器の接続されるネットワークが、プライベートアドレスを使用していても、監視可能であること\\
	IoT機器が接続されるネットワークを予め予測することは難しい。
	そのため、IoT機器にプライベートアドレスが割り振られる可能性がある。
	そのような状況でも監視することができる必要がある。
\item ネットワークが違っていても、一つの画面で確認できること\\
\item IoTサービスの変更が不要であること\\
	サーバの変更は開発者への負担となるため、サーバの変更を避けたい。
\item 監視サーバを立てる必要がないこと\\
	新たに監視サーバを立てることは、設定や構築作業が必要となるため、開発者の負担となる。
	そのため、新規に監視サーバを立てる必要が無いことが求められる。
\item 機器に異常があった場合に、運用者に通知を行う機能があること\\
	常に監視画面を見ているわけには行かないので、アラート機能等があると良い。
\end{itemize}

そこで、従来からある手法にて対応できるか、考えた。
\section{サーバからの問い合わせによる監視}
	従来から機器監視に用いられてきた手法として，定期的に機器監視サーバから対象機器に状態を問い合わせる手法がある．
	機器監視サーバから，監視対象機器上のエージェントプログラムに，現在の状態を問い合わせる事で機器の監視を実現している．
	\medskip

	代表的なものとして、次のような物がある。
	\begin{itemize}
		\item Ping\\
			Pingとは、ICMPメッセージをやり取りするプログラムである。
			ICMPとは、InternetControlManagementProtocolの事で、IPネットワークにおいて、IPパケットの不到達等を通知する為の取り決めである。
			ICMPには、ICMP Echo Request Echo Replyが定義されており、ICMP Echo Requestを受け取った機器は、ICMP Echo Replyを返さなくてはならない。
			監視を行う機器から、Pingを用いて、ICMP Echo Requestを監視対象機器のIPアドレスに送信し、Echo Replyの有無から、機器の存在を確認する事ができる。
		\item SNMPによる問い合わせ\\
			SNMPとは、Simple Network Management Protocolの事で、ネットワークの監視・管理を行うための、取り決めである。
			SNMPには、SNMPマネージャとSNMPエージェントが存在する。
			SNMPマネージャは、監視を行う機器上で動作し、SNMPエージェントは、監視される機器の上で動作する。
			SNMPを利用した機器の状態監視の方法として、SNMPマネージャがSNMPエージェントに問い合わせを行い取得する方法がある。
	\end{itemize}
	
	この手法だと、コンピュータであればほぼすべての機器が対応しているので、手軽に監視できる。
	しかし、監視する側のコンピュータに、全ての監視対象のIPアドレスを設定する必要があるので、大量にIoT機器が使用される事を考えると負担となる。

\section{監視対象機器からの通知による監視}
	機器監視手法として，定期的に監視対象機器から機器監視サーバーへ状態を送信するという手法がある。
	監視対象機器上のエージェントプログラムが，指定した時間毎に機器監視サーバーへ状態を送信することで，機器の監視を実現している．
	\medskip
	
	代表的なものとして、次のようなものがある。
	\begin{itemize}
		\item SNMP Trapによる取得\\
			SNMPでは、予めSNMPエージェントに設定をしておくことによって、状態の変化をSNMPマネージャへ知らせることができる機能がある。
			この機能を利用して、SNMPエージェントの状態を取得できる。
		\item TeregrafとInfluxdbによる、機器の状態の通知と蓄積\\
					Teregrafとは、監視対象にインストールされるエージェントプログラムで、監視される機器の上で動作する。
					Influxdbとは、時系列データを格納することに特化したデータベースで、この中では機器の状態を蓄積することに使用され、監視を行う機器の上で動作する。
					Teregrafは、機器の状態を定期的に取得しInfluxdbに送信する。そして、Influxdbは、それを蓄積する。
					Influxdbに蓄積されたデータは、Influxdbに対応した可視化アプリケーション（Grafana等）によって可視化され、監視を行うことができる。
	\end{itemize}
	
	この手法だと、前項で述べた手法と比べて、監視を行う機器に対し監視対象の機器のIPアドレス等を登録する作業が不要である。
	しかし、各機器ごとに、通知の送信先を設定しなくてはならない為、負担となる。

	この手法は、IoT機器の監視の参考にはなるが、IoT機器が利用される数を考えると、負担が大きい。

\section{株式会社SORACOMが機能として提供している監視} %SORACOMの話を入れる。
	ネットワークの提供者がオプションとして提供している監視機能を利用する方法もある。
	ここでは、SORACOMが提供しているネットワークを利用した場合の監視を取り上げる。
	
	株式会社SORACOMとは、IoTプラットフォームとして、通信とクラウドへの接続を提供している企業である。
	通信はMVMOとして携帯電話回線網を使用しており、SORACOM用SIMを購入し、機器にSIMモジュールを取り付けることで利用できる。
	株式会社SORACOMでは、各SIMのアクティベートや通信量設定の変更、クラウドへの接続の設定等を行うためのWebインターフェースを提供しており、
	プラットフォーム利用者はこのWebインターフェースをインターネットを介して利用し、各種設定を行うことができる。
	そのWebインターフェースには、各SIMの通信量や状態を把握するためのページが存在しており、ここで各SIMがリンクアップしているかどうかを監視することもできる。

	この機能を用いた場合、新たに監視サーバ等を立てる必要が無く、また、インターネットに接続できる環境ならば、どこからでも監視を行うことが可能である。
	しかし、株式会社SORACOMが提供しているネットワーク以外のネットワークに接続された機器は監視することが出来ない。

	このような独立したサービスは、提供者が監視用サーバをたてなくてはいけないといった負担の軽減になり、また、そのような監視のニーズがある。

\section{VPNの利用}
	VPNを利用して、既存の監視手法を使用する方法もある。
	この場合、機器が利用しているネットワークによらない監視を行うことができるが、監視サーバや機器に対し、IPアドレスを設定することや、各ソフトウェアに設定する事は、改善されない。

\section{既存手法のまとめ}
	既存の手法として，サーバーからの問い合わせによる監視，監視対象機器からの通知による監視，ネットワークによる監視、VPNの利用といった手法がある．
	しかし、このような手法では、
	\begin{enumerate}
		\item IoT機器の接続されるネットワークが、プライベートアドレスを使用していても、監視可能であること
		\item ネットワークが違っていても、一つの画面で確認できること
		\item IoTサービスの変更が不要であること
		\item 監視サーバを立てる必要がないこと
	\end{enumerate}
	といった事を満たすことが出来ない。

	次に示すのは、各要件が満たせるかどうかについての表である。\\
	\begin{table}[htbp]
	\caption{既存手法の比較表}
	\begin{tabular}{|l|l|l|l|l|l|} \hline
		\multicolumn{2}{|l|}{既存手法＼要件番号} & 
		\multicolumn{1}{|l|}{1} &
		\multicolumn{1}{|l|}{2} &
		\multicolumn{1}{|l|}{3} &
		\multicolumn{1}{|l|}{4} \\ \hline \hline
		監視サーバからの問い合わせによる監視 & VPNと併用しない場合 & X & ◯ & ◯ & X  \\ \cline{2-6}
			& VPNと併用する場合 & ◯ & ◯ & ◯ & X \\ \hline
		\multicolumn{2}{|l|}{監視される機器からの通知による監視} & ◯ & ◯ & ◯ & X \\ \hline
		\multicolumn{2}{|l|}{SORACOMが提供している監視} & ◯ & X & ◯ & ◯ \\ \hline
	\end{tabular}
	\end{table}
	この表から分かるように、全ての要件を満たした監視手法は無い。
	
	これら議論から、
	通知による、IoT機器の数に対応した、設定不要の独立したサービスの存在が求められる。

