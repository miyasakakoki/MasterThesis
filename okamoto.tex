%subsection


\subsection{実験概要}
2015年12月8日から2016年2月26日まで、NPO法人コミュニティリンクへのインターンシップの一環として、実験を行った。
人流観測を行い、結果を分析し商店街の活性化に役立てるという趣旨で行った。
人流観測は、2016年2月7日から2016年3月14日まで行った。
岡本商店街とは、神戸市東灘区にある阪急岡本駅とJR摂津本山駅の間にある商店街のことである。

人流観測とは、各地点から各地点迄をある時に移動した人数を観測するものである。
通常は、観察員がカウンタを用いて数えるが、それでは各地点間を移動した人数はわかるが、その人が以前どの地点に居たのかはわからない。
そこで、携帯電話についているWifi機能を利用し、観測を行うこととした。
携帯電話のWifi機能は、無線LANの接続に使われるが、接続毎にWifi機能を有効にすることが手間なため、常時ONにしている人も少なくない。
携帯電話のWifi機能を有効にしている場合、携帯電話から接続可能な無線LANを探す為、プローブパケットというものが定期的に送出される。
プローブパケットには、そのプローブパケットを送出した機器の物理アドレスが含まれている。
そのプローブパケットを複数地点で観測し、含まれている物理アドレスを照合することで、携帯電話端末を持った人がどのように移動をしたのかが分かる。
岡本商店街では、この原理を利用して、人流観測を行った。

本事例では、岡本商店街の5店舗に開発した観測機器を設置し、サーバにて蓄積・分析・可視化を行った。
開発した観測機器は、RaspberryPiとampsence、rsyncというソフトウェアを利用した。
図\ref{fig:okamoto_pict1}は、開発した観測機器である。
\begin{figure}[htbp]
\includegraphics[width=16cm]{images/okamoto_pict1.png}
\caption{岡本商店街人流観測 使用した機器}
\label{fig:okamoto_pict1}
\end{figure}

RaspberryPiとは、小型PCの一つで安価に入手が可能である。
ampsenceとは、プローブパケットを受信しファイルへ記録するソフトウェアである。
図\ref{fig:okamoto_pict2}は、携帯電話と観測機器、サーバーの関係を表している。
\begin{figure}[htbp]
\includegraphics[width=16cm]{images/okamoto_pict2.png}
\caption{岡本商店街人流観測 動作イメージ？}
\label{fig:okamoto_pict2}
\end{figure}

rsyncとは、ディレクトリの中を同期させるプログラムで、遠隔にあるコンピュータの指定したディレクトリの中と、手元のコンピュータの指定したディレクトリを同期することができる。
開発した観測機器では、定期的にrsyncを実行するシェルプログラムを置き、起動時に自動で実行するよう設定した。
それによって、各所に設置された観測機器の情報をサーバー上に集約・蓄積する。
分析・可視化については、Webアプリケーションを作成した。
分析については、作成したプログラムがとりおこない、可視化については、作成したWebアプリケーションが行っている。
図\ref{fig:okamoto_ss}は作成したWebアプリケーションである。
\begin{figure}[htbp]
\includegraphics[width=16cm]{images/okamoto_scr1.png}
\caption{岡本商店街人流観測可視化アプリケーションスクリーンショット}
\label{fig:okamoto_ss}
\end{figure}

実験としては、個々のRaspberryPi内に、XX分おきに次のような形式のデータをファイルとして書き出し、定期的に実行されるrsyncによって、サーバー側のディレクトリと個々のRaspberryPiのディレクトリを同期させることで収集した。


\subsection{実験にあたって考慮した点}
実験機材の開発と実験を行うにあたって、次のような点を考慮し、作成した。
\begin{itemize}
\item 機器が設置されるネットワークは、店舗のネットワークであるため、ネットワーク機器の設定等を変更せずに設置することができるよう考慮した。
\item ソフトウェアのアップデートやトラブルに備え、VPNを張り、VPN越しにログインできるように設定した。
\item 店舗ネットワークが利用できない個所の場合は、SORACOM Airを用いることとした。
\item サーバー側の不良に備え、機器自体にも情報を蓄積しておくことにした。
\end{itemize}

\subsection{実験結果}
実験によって、次のような結果が得られた。


\subsection{実験でのトラブル}
しかし、実験の際に次のような点が問題となった。


\subsection{考察}













\begin{comment}
どうしたら良いのかわからなくなっている。

頭の中では、このようなストーリーかなと考えている。
１．岡本商店街でこんなことをやった
　１．こんな人流観測をしました。
　　１．岡本商店街とは
　　２．人流観測とは
　　３．こんなものを使って観測しました。
　　４．こんな結果が得られました。
　２．だけど、機器の監視が大変でした。それによってこんな問題がおきました。
　　１．こんなトラブルが有りました。
　　２．それによってこんな問題がありました。
　　３．なので、監視が必要と思いました。
２．何故大変だったのか、考えてみました。
　１．まず、岡本商店街での問題を整理しました。
　　１．機器の数が多いことで、こんな問題が有りました。
　　２．機器が接続するネットワークにNAPTがあったので、このように困りました。
　２．他の人達はこのことについてどう思っているのか聞いてみました。
　　１．ルナネクサスさんへヒアリング
　　２．SORACOMさんへヒアリング
　　３．以上２件から、皆機器の監視について困っていることがわかりました。
３．ヒアリングの結果を元に、こんな物が有れば良いのではと思いました。
　１．機器がNAPTの内側にあっても、動いているのか監視できる事が必要だと思いました。
　２．ネットワークが違っていても、同じUIで閲覧できる事が必要だと思いました。
　３．機器を追加する時に、あまり手間がかからないことも大切だと思いました。
　４．セキュリティの都合でブロックされることが無い事も大切だと思いました。
４．作ってみました
　１．システムの全体像（こんな感じの物をつくってみました）
　２．各要素の説明（各要素はこんな動きをします）
　３．各要素の関連（各要素同士はこんなふうに連携します）
５．役に立ったか検証してみました
　1. 必要となる機能が満たされているかどうか検証してみました。
　　１．機器の現在の状態の確認ができる事を確認しました。
　　２．機器の過去の状態が確認できることを確認しました。
　2. 実際に役に立ったのか検証してみました。
　　１．時間がなかった事と、使ってくれるユーザーがいなかったので検証できませんでした。
\end{comment}








